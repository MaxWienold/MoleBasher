let pubsub={events:{},emit:function(e,t){console.log(e),this.events[e]&&this.events[e].forEach(e=>{e(t)})},subscribe:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},unsubscribe:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e.name!==t.name))}},gameFlow=function(e){let t=document.getElementById("menu-difficulty"),n=document.getElementById("menu-result"),i=document.getElementById("resHeader"),s=document.getElementById("backMenu"),o=document.getElementById("startAgain"),a=Array.prototype.slice.call(document.getElementsByClassName("difficultyChoice"));console.log(a),a.forEach(e=>{console.log(e),e.addEventListener("mousedown",function(e){n.style.display="none",t.style.display="none",pubsub.emit("startGame",this.innerHTML),console.log(this.innerHTML)})});s.addEventListener("mousedown",function(e){n.style.display="none",t.style.display="initial"}),o.addEventListener("mousedown",()=>{n.style.display="none",t.style.display="none",pubsub.emit("startGame")});return pubsub.subscribe("gameOver",function(e){i.innerHTML="You have bashed "+e+" moles!",n.style.display="initial",t.style.display="none"}),{}};function randInd(e,t){return Math.trunc(e+Math.random()*(t-e))}let gameObject=function(){let e,t={hard:{spawnMin:5,spawnMax:15,lifeMin:5,lifeMax:10},medium:{spawnMin:5,spawnMax:15,lifeMin:20,lifeMax:40},easy:{spawnMin:5,spawnMax:15,lifeMin:40,lifeMax:60}},n={time:0,score:0,spawnTime:0},i=function(i){i&&(e=t[i]),n.time=90,n.score=0,n.spawnTime=randInd(e.spawnMin,e.spawnMax),s.forEach(e=>{e.classList.remove("active")})},s=Array.prototype.slice.call(document.getElementsByClassName("mole")),o=document.getElementById("timeLeft"),a=document.getElementById("molesHit");s.forEach(e=>{e.mole=(active=!1,time=randInd(10,40),{time:time,active:active}),console.log(e.mole.time),e.addEventListener("mousedown",function(){this.classList.contains("active")&&(this.classList.toggle("active"),this.mole.active=!1,n.score++)})});let l=function(t){let n=s.filter(function(e){return!e.mole.active});if(n.length>0){let i=randInd(0,n.length);n[i].mole.active=!0,n[i].mole.time=t+randInd(e.lifeMin,e.lifeMax)}},c=function(t){i(t);let c=0,m=setInterval(function(e){++c%10==0&&n.time--},100);requestAnimationFrame(function u(){0==n.time?(cancelAnimationFrame(u),clearInterval(m),pubsub.emit("gameOver",n.score),i(t)):(s.forEach(t=>{t.mole.time==c&&(t.mole.active=!1,t.mole.time=c+randInd(e.lifeMin,e.lifeMax)),t.mole.active?t.classList.add("active"):t.classList.remove("active")}),c==n.spawnTime&&(l(c),n.spawnTime=c+randInd(e.spawnMin,e.spawnMax)),requestAnimationFrame(u));o.innerHTML=n.time;a.innerHTML=n.score})};return pubsub.subscribe("startGame",c),{moleElems:s,start:c}};window.onload=function(){gameFlow(),gameObject();let e=document.getElementById("hammer");document.onmousemove=function(t){var n,i,s;null==(t=t||window.event).pageX&&null!=t.clientX&&(i=(n=t.target&&t.target.ownerDocument||document).documentElement,s=n.body,t.pageX=t.clientX+(i&&i.scrollLeft||s&&s.scrollLeft||0)-(i&&i.clientLeft||s&&s.clientLeft||0),t.pageY=t.clientY+(i&&i.scrollTop||s&&s.scrollTop||0)-(i&&i.clientTop||s&&s.clientTop||0)),e.style.top=t.pageY-50+"px",e.style.left=t.pageX-12+"px"},document.onmousedown=function(t){e.classList.toggle("active")},document.onmouseup=function(t){e.classList.toggle("active")}};